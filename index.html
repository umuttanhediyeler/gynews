<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Türkiye piyasaları için anlık finans haberleri sunan hızlı ve sade bir uygulama.">
    <title>Finans Gündemi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-color: #344f9e;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "react-dom/client": "https://aistudiocdn.com/react-dom@^19.1.1/client",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.20.0"
  }
}
</script>
</head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script type="module">
      // Prevent crash in browser environments where process.env is not defined.
      // The execution environment is expected to provide a valid API_KEY.
      if (typeof window.process === 'undefined') {
        window.process = { env: { API_KEY: '' } };
      }

      import React, { useState, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI } from "@google/genai";

      // --- Components ---

      const LoadingSpinner = () => {
        return (
          React.createElement("div", { className: "flex justify-center items-center" },
            React.createElement("svg", { className: "animate-spin h-10 w-10 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
              React.createElement("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
              React.createElement("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
            )
          )
        );
      };

      const ErrorDisplay = ({ message }) => {
        return (
          React.createElement("div", { className: "bg-white/10 backdrop-blur-sm text-white p-4 rounded-lg shadow-lg max-w-md mx-auto text-center", role: "alert" },
            React.createElement("div", { className: "flex flex-col items-center" },
              React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-8 w-8 mb-2 text-yellow-300", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 },
                React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" })
              ),
              React.createElement("p", { className: "font-bold mb-1" }, "Bir sorun oluştu"),
              React.createElement("p", { className: "text-sm text-gray-200" }, message)
            )
          )
        );
      };
      
      const SourceIcon = () => (
          React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-4 w-4 mr-1.5 inline-block text-gray-300", viewBox: "0 0 20 20", fill: "currentColor" },
              React.createElement("path", { fillRule: "evenodd", d: "M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm5 4a1 1 0 100 2h2a1 1 0 100-2H9zm-1 4a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z", clipRule: "evenodd" })
          )
      );

      const NewsCard = ({ item }) => {
        return (
          React.createElement("div", { className: "bg-white/10 backdrop-blur-sm rounded-lg shadow-lg overflow-hidden transition-transform duration-300 hover:scale-105 hover:shadow-xl w-full p-4 flex flex-col" },
            React.createElement("div", { className: "flex-grow" },
              React.createElement("h3", { className: "text-lg font-bold text-white mb-2 leading-tight" }, item.headline),
              React.createElement("p", { className: "text-gray-200 text-sm mb-3" }, item.summary)
            ),
            React.createElement("div", { className: "text-xs text-gray-300 flex items-center mt-auto pt-2 border-t border-white/20" },
              React.createElement(SourceIcon, null),
              React.createElement("span", null, item.source)
            )
          )
        );
      };
      const MemoizedNewsCard = React.memo(NewsCard);

      // --- Services ---
      
      const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

      const fetchDailyNews = async () => {
        try {
          const response = await ai.models.generateContent({
            model: "gemini-2.5-flash",
            contents: "Türkiye ile ilgili bugünün en önemli 8 finans ve piyasa haberini özetle. Her haber için kısa bir başlık, 2-3 cümlelik kısa bir özet ve orijinal kaynağın adını ekle. Çıktıyı, her biri 'headline', 'summary' ve 'source' anahtarlarını içeren bir JSON nesne dizisi olarak biçimlendir.",
            config: {
              tools: [{googleSearch: {}}],
              thinkingConfig: { thinkingBudget: 0 }, // Disable thinking for faster response
            },
          });

          const text = response.text.trim();
          
          const startIndex = text.indexOf('[');
          const endIndex = text.lastIndexOf(']');

          if (startIndex === -1 || endIndex === -1 || endIndex < startIndex) {
              // This error will be caught and replaced by a generic one below.
              throw new Error("Invalid response format from API.");
          }

          const jsonString = text.substring(startIndex, endIndex + 1);
          const newsData = JSON.parse(jsonString);
          
          if (!Array.isArray(newsData)) {
              // This error will be caught and replaced by a generic one below.
              throw new Error("Invalid data structure from API.");
          }
          const news = newsData;

          const groundingChunks = response.candidates?.[0]?.groundingMetadata?.groundingChunks || [];
          const sources = groundingChunks
            .map((chunk) => ({
              uri: chunk.web?.uri || '',
              title: chunk.web?.title || 'Bilinmeyen Kaynak'
            }))
            .filter((source) => source.uri);
          
          const uniqueSources = Array.from(new Map(sources.map(item => [item.uri, item])).values());

          return { news, sources: uniqueSources };

        } catch (error) {
          console.error("Haberler alınırken hata oluştu:", error);
          // Provide a generic, user-friendly error message.
          throw new Error("Haberler yüklenemedi. Lütfen daha sonra tekrar deneyin.");
        }
      };

      // --- App ---
      
      const App = () => {
        const [newsItems, setNewsItems] = useState([]);
        const [sources, setSources] = useState([]);
        const [isLoading, setIsLoading] = useState(true);
        const [error, setError] = useState(null);

        useEffect(() => {
          const loadNews = async () => {
            setIsLoading(true);
            setError(null);
            try {
              const { news, sources } = await fetchDailyNews();
              setNewsItems(news);
              setSources(sources);
            } catch (err) {
              if (err instanceof Error) {
                setError(err.message);
              } else {
                setError("Beklenmedik bir hata oluştu.");
              }
            } finally {
              setIsLoading(false);
            }
          };
          
          loadNews();
        }, []);

        const renderContent = () => {
          if (isLoading) {
            return React.createElement("div", { className: "flex justify-center items-center min-h-screen" }, React.createElement(LoadingSpinner, null));
          }
          if (error) {
            return React.createElement("div", { className: "flex justify-center items-center min-h-screen px-4 py-8" }, React.createElement(ErrorDisplay, { message: error }));
          }
          if (newsItems.length === 0) {
              return React.createElement("div", { className: "text-center pt-16 text-gray-200" }, "Şu anda haber bulunmuyor.");
          }

          return (
            React.createElement(React.Fragment, null,
              React.createElement("div", { className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 p-4" },
                newsItems.map((item, index) => (
                  React.createElement(MemoizedNewsCard, { key: item.headline + index, item: item })
                ))
              ),
              sources.length > 0 && (
                  React.createElement("div", { className: "p-4 mt-4 mx-4 bg-white/10 backdrop-blur-sm rounded-lg shadow-lg" },
                      React.createElement("h2", { className: "text-xl font-bold text-white mb-4" }, "Kaynaklar"),
                      React.createElement("ul", { className: "list-disc list-inside space-y-2" },
                          sources.map((source, index) => (
                              React.createElement("li", { key: source.uri + index, className: "text-sm text-gray-200" },
                                  React.createElement("a", { 
                                      href: source.uri, 
                                      target: "_blank", 
                                      rel: "noopener noreferrer",
                                      className: "text-blue-300 hover:underline",
                                      "aria-label": `Makaleyi oku: ${source.title}`
                                  },
                                      source.title
                                  )
                              )
                          ))
                      )
                  )
              )
            )
          );
        };

        return (
          React.createElement("div", { className: "min-h-screen text-white font-sans" },
            React.createElement("main", { className: "max-w-7xl mx-auto py-6 sm:px-6 lg:px-8" },
              renderContent()
            )
          )
        );
      };

      // --- Mount ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        React.createElement(React.StrictMode, null, React.createElement(App, null))
      );
    </script>
  </body>
</html>
